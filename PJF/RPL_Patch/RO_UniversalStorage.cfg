// Update the amazing Universal Storage wedges for use with
// RealismOverhaul
//
// Author: Paul '@pjf' Fenwick
// License: Same as RealismOverhaul itself.

// The fuel cell rates are based upon the Apollo service module
// settings by RedAV8R, and feedback from Paul Kingtiger, the mod's
// author.
//
// For a 1kW output, the following standard rates are used:
//
// LiquidH2       = .0000584244
// LiquidOxygen   = .0000443399
// ElectricCharge = 1
// Water          = .0000443654 (3.833 litres/day)
//
// A kerbonaut requires 1.7 litres/day of water, so a 1kW
// cell can sustain a little over two kerbonauts in water.
//
// The US cells themselves are about half the size of an Apollo cell
// (assuming each wedge holds about 40-50cm diameter sphere), and Paul
// has indicated they're modelled after an output of ~ 528W.
//
// For ease of management, I'm making the cells have an output of
// 500W. This is enough to sustain one kerbonaut in water, and
// makes power planning and maths easier.
//
// The cell is designed with basic reserves to produce and hold one litre
// of water. This would require:
// 
// LiquidH2     = 1.3168906499 litres
// LiquidOxygen = 0.9994248931 litres
//
// Tank wedges are modelled after water wedge being able to hold 58
// litres of water, which is in the original part definition, and
// consistent with a spherical tank ~ 40cm in diameter.  LOX and LH2
// wedges contain enough material to produce one water wedge after
// processing through a fuel cell.
//
// A example Life Support octo-core could consist of:
//
//  - 2 x Fuel Cells (supports 2 kerbonauts in water)
//  - 2 x LH2 (fuel, 15 days with both cells running)
//  - 2 x LO2 (fuel, 15 days with both cells running)
//  - 1 x LO2 (breathing gas, 30 days @ 2 kerbonauts)
//  - 1 x Water (start empty to avoid fuel cell overflows)
//
// This core does not manage waste (water, solids, CO2), but
// the next release of US looks like it might have parts for that. :)

@PART[US_i_Wedge_FuelCell]
{

    @description = This small fuel cell consumes hydrogen and oxygen to produce potable water, heat, and a moderate electrical output. Rated to 500W, and with water output enough water to sustain one kerbonaut, this cell has integrated resources to run just over twelve hours. Although much safer for Kerbals than RTGs, please don't tease the stirring fans.

    !RESOURCE[Hydrogen]
    {
    }

    !RESOURCE[Oxygen]
    {
    }

    // Resources are enough to produce 1 litre of water

    RESOURCE
    {
        name      = LiquidH2
        amount    = 1.3168906499
        maxAmount = 1.3168906499
    }

    RESOURCE
    {
        name      = LiquidOxygen
        amount    = 0.9994248931
        maxAmount = 0.9994248931
    }

    // Generator modelled on RedAV8R's Apollo service module work

    !MODULE[ModuleGenerator]

    MODULE
    {
        name            = TacGenericConverter
        converterName   = Fuel Cell
        
        // ConversationRate is the number of kW we want produced
        // This unit is rated to 500W
        conversionRate  = 0.5

        // The 'false' in outputResources means we stop processing
        // if Water is full (otherwise the cell overflows).
        // We *will* continue running if EC is full. Write yourself
        // a kOS controller if you want to throttle that. :)

        inputResources  = LiquidH2, .0000584244, LiquidOxygen, .0000443399
        outputResources = ElectricCharge, 1, true, Water, .0000443654, false
    }
}

@PART[US_j_Wedge_Elektron]
{
    !MODULE[ModuleGenerator]

    MODULE
    {
        name            = TacGenericConverter
        converterName   = Elektron
        
        // A ConversationRate of 1 is a 2kW unit.
        // Here, we're running it at 500W, simply so we can nicely
        // mirror the Fuel Cell.

        conversionRate  = 0.25

        // These are the Fuel Cell parameters flipped for LOX/LH2/H2O

        // I've required *double* the energy to split H2O as is
        // generated by combining it in a fuel cell. However this
        // is not based upon *any* real world data. Alternative
        // parameters welcome!

        outputResources = ElectricCharge, 1, true, Water, .0000443654, false

        inputResources  = Water, .0000443654, ElectricCharge, 2
        outputResources = LiquidH2, .0000584244, false, LiquidOxygen, .0000443399, false
    }
}

// The cores contain integrated equipment to convert LOX into O2.
// These are based upon RedAV8R's Apollo CSM work.
//
// The QuadCore can support up to  4 kerbonauts
// The OctoCore can support up to 16 kerbonauts
//
// By using TacGenericConverters, these will actally run at a level to
// support the number of kerbonauts on the vessel. :)

@PART[US_c_Hub_Quadcore]
{
    MODULE
    {
        name            = TacGenericConverter
        converterName   = Oxygen Supply
        conversionRate  = 4

        // The 'false' in outputResources means we stop processing
        // if oxygen is full. :)

        inputResources  = LiquidOxygen, .0000073936, ElectricCharge, 0.05
        outputResources = Oxygen, 0.006365, false
    }
}

@PART[US_d_Hub_Octocore]
{
    MODULE
    {
        name            = TacGenericConverter
        converterName   = Oxygen Supply
        conversionRate  = 16

        // The 'false' in outputResources means we stop processing
        // if oxygen is full. :)

        inputResources  = LiquidOxygen, .0000073936, ElectricCharge, 0.05
        outputResources = Oxygen, 0.006365, false
    }
}

// Wedges contain enough materials to produce 58 litres (one wedge) 
// of water if run through the fuel cell.

// I've also updated the descriptions to people can know how long
// they might last.

@PART[US_l_Wedge_Hydrogen]
{

    @description = Contains a large spherical canister of cryogenically stabilized liquid Hydrogen, enough to run a 500W fuel cell for a little over 15 days, but can also be used to inflate balloon animals. Please keep away from birthday candles or Jeb's ego.  

    !RESOURCE[Hydrogen]
    {
    }

    RESOURCE
    {
        name      = LiquidH2
        // Amounts are 58 * 1.3168906499
        amount    = 76.3796576942
        maxAmount = 76.3796576942
    }
}

@PART[US_m_Wedge_Oxygen]
{

    @description = Contains four individual oxygen canisters under extreme cryogenic pressure. Seperated to ensure redundancy in the unlikely event of explosion from external forces. Enough to power a 500W fuel cell for a little over 15 days, or keep a single kerbonaut alive for 90. Licking the boiloff valve is discouraged.

    !RESOURCE[Oxygen]
    {
    }

    RESOURCE
    {
        name      = LiquidOxygen
        // Amounts are 58 * 0.9994248931
        amount    = 57.9666437998
        maxAmount = 57.9666437998
    }
}

// @PART[US_q_Wedge_Water]
//
// Does not require updating. \o/

// @PART[US_Radial_Oxygen]
//
// Represents merely compressed O2, and does not require updating either!
